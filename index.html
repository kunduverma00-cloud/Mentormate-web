<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentorMate Pro - Professional Session Tracking</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- Firebase Status -->
    <div id="firebaseStatus" class="firebase-status">
        <div class="status-dot"></div>
        <div class="status-text">Connecting...</div>
    </div>

    <!-- Role Selection Screen -->
    <div id="roleSelectionScreen" class="screen active">
        <div class="container">
            <div class="welcome-header">
                <h1>🎓 MentorMate Pro</h1>
                <p>Professional Session Tracking System</p>
            </div>

            <div class="role-cards">
                <div class="role-card" onclick="selectRole('student')">
                    <div class="role-icon">👨‍🎓</div>
                    <h3>Student Dashboard</h3>
                    <p>Track your learning sessions, take tests, and monitor your progress</p>
                </div>

                <div class="role-card" onclick="selectRole('mentor')">
                    <div class="role-icon">👨‍🏫</div>
                    <h3>Mentor Panel</h3>
                    <p>Monitor student progress, manage sessions, and analyze performance</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mentor Login Screen -->
    <div id="mentorLoginScreen" class="screen">
        <div class="container">
            <div class="login-card">
                <h2>🔐 Mentor Access</h2>
                <p>Enter password to access mentor panel</p>

                <div class="form-group">
                    <input type="password" 
                           id="mentorPasswordInput" 
                           placeholder="Enter mentor password" 
                           class="form-input"
                           onkeypress="handlePasswordKeypress(event)">
                    <div id="passwordError" class="error-message"></div>
                </div>

                <div class="button-group">
                    <button onclick="verifyMentorPassword()" class="btn btn-primary">
                        🚀 Access Panel
                    </button>
                    <button onclick="backToRoleSelection()" class="btn btn-outline">
                        ← Back
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div id="studentDashboard" class="screen">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="container">
                <div class="header-content">
                    <h1>👨‍🎓 Student Dashboard</h1>
                    <div class="header-info">
                        <div id="studentTime" class="current-time">13:35:37</div>
                        <button onclick="backToRoleSelection()" class="btn btn-outline btn-small">
                            🚪 Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <!-- Daily Points Display -->
                <div class="points-grid">
                    <div class="points-card">
                        <div class="points-info">
                            <h3>Session Time</h3>
                            <div class="points-value" id="totalSessionTime">0h 0m</div>
                            <div class="points-label">Today Total</div>
                        </div>
                    </div>

                    <div class="points-card secondary">
                        <div class="points-info">
                            <h3>Today's Points</h3>
                            <div class="points-value" id="studentPoints">0</div>
                            <div class="points-label">Earned Today</div>
                        </div>
                    </div>
                </div>

                <!-- FIXED: Active Session Monitor -->
                <div id="activeSessionMonitor" class="active-session-monitor" style="display: none;">
                    <div class="session-monitor-header">
                        <h3>🔴 Active Study Session</h3>
                        <div class="session-controls">
                            <button id="pauseBtn" onclick="pauseSession()" class="btn btn-warning btn-small">
                                ⏸️ Check Out
                            </button>
                            <button onclick="stopSession()" class="btn btn-danger btn-small">
                                ⏹️ End Session
                            </button>
                        </div>
                    </div>

                    <div class="session-monitor-body">
                        <div class="progress-circle">
                            <div class="progress-ring">
                                <svg class="progress-svg" width="120" height="120">
                                    <circle class="progress-ring-background" cx="60" cy="60" r="54"></circle>
                                    <circle id="progressRingFill" class="progress-ring-fill" cx="60" cy="60" r="54"></circle>
                                </svg>
                            </div>
                            <div class="progress-text">
                                <div id="activeSessionTime" class="session-time">00:00</div>
                                <div id="sessionPercentage" class="session-percentage">0%</div>
                            </div>
                        </div>

                        <div class="session-details">
                            <div class="session-info">
                                <h4 id="activeSessionName">Session Name</h4>
                            </div>
                            <div class="session-stats">
                                <div class="stat">
                                    <span class="stat-label">Target:</span>
                                    <span id="targetDuration" class="stat-value">60m</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Elapsed:</span>
                                    <span id="elapsedTime" class="stat-value">0m</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Points:</span>
                                    <span id="currentPoints" class="stat-value">0</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">Status:</span>
                                    <span id="sessionStatus" class="stat-value">Active</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FIXED: Paused Session Resume -->
                <div id="pausedSessionResume" class="paused-session-resume" style="display: none;">
                    <div class="paused-header">
                        <h3>⏸️ Session Paused</h3>
                        <button onclick="resumeSession()" class="btn btn-success btn-small">
                            ▶️ Resume Session
                        </button>
                    </div>
                    <div class="paused-info">
                        <div class="paused-details">
                            <div>Study session: <span id="pausedSessionName">Session Name</span></div>
                            <div id="pausedSessionTime">Paused at: 00:00</div>
                        </div>
                    </div>
                </div>

                <!-- Section Tabs -->
                <div class="section-tabs">
                    <button class="tab-btn active" onclick="showSection('routines')">📚 Smart Sessions</button>
                    <button class="tab-btn" onclick="showSection('tests')">📝 Tests</button>
                    <button class="tab-btn" onclick="showSection('progress')">📊 Analytics</button>
                </div>

                <!-- Smart Learning Sessions -->
                <div id="routinesSection" class="content-section active">
                    <div class="section">
                        <h2>🎯 Smart Learning Sessions</h2>
                        <div id="studentRoutines" class="routines-grid">
                            <!-- Routines will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Tests Section -->
                <div id="testsSection" class="content-section">
                    <div class="section">
                        <h2>📝 Available Tests</h2>
                        <div id="availableTests" class="tests-grid">
                            <!-- Tests will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Progress Analytics Section -->
                <div id="progressSection" class="content-section">
                    <!-- Progress Summary -->
                    <div class="analytics-summary">
                        <div class="summary-card">
                            <h3>📊 Weekly Performance</h3>
                            <div class="summary-stats">
                                <div class="summary-stat">
                                    <div class="stat-value" id="weeklyPoints">0</div>
                                    <div class="stat-label">Points</div>
                                </div>
                                <div class="summary-stat">
                                    <div class="stat-value" id="weeklyHours">0h</div>
                                    <div class="stat-label">Study Time</div>
                                </div>
                                <div class="summary-stat">
                                    <div class="stat-value" id="weeklySessions">0</div>
                                    <div class="stat-label">Sessions</div>
                                </div>
                                <div class="summary-stat">
                                    <div class="stat-value" id="weeklyAverage">0%</div>
                                    <div class="stat-label">Avg. Efficiency</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Daily Chart -->
                    <div class="daily-breakdown">
                        <h3>📈 7-Day Performance</h3>
                        <div id="dailyChart" class="chart-container">
                            <!-- Chart will be rendered here -->
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="section">
                        <h3>📋 Recent Activity</h3>
                        <div id="studentActivity" class="activity-feed">
                            <!-- Activity will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mentor Dashboard -->
    <div id="mentorDashboard" class="screen">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="container">
                <div class="header-content">
                    <h1>👨‍🏫 Mentor Control Panel</h1>
                    <div class="header-info">
                        <div id="mentorTime" class="current-time">13:35:37</div>
                        <button onclick="backToRoleSelection()" class="btn btn-outline btn-small">
                            🚪 Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="dashboard-content">
                <!-- Section Tabs -->
                <div class="section-tabs">
                    <button class="tab-btn active" onclick="showMentorSection('analytics')">📊 Student Analytics</button>
                    <button class="tab-btn" onclick="showMentorSection('sessions')">🔴 Live Sessions</button>
                    <button class="tab-btn" onclick="showMentorSection('routines')">📅 Manage Sessions</button>
                    <button class="tab-btn" onclick="showMentorSection('tests')">📝 Test Reports</button>
                    <button class="tab-btn" onclick="showMentorSection('punishments')">⚖️ Punishments</button>
                </div>

                <!-- Student Analytics Section -->
                <div id="mentorAnalyticsSection" class="content-section active">
                    <!-- Professional Analytics Overview -->
                    <div class="professional-analytics">
                        <div class="analytics-overview">
                            <h2>📊 Student Performance Overview</h2>
                            <div class="overview-cards">
                                <!-- Today's Performance -->
                                <div class="overview-card">
                                    <div class="card-header">
                                        <h3>Today's Performance</h3>
                                        <div id="todayDate" class="date-label">Monday, September 22, 2025</div>
                                    </div>
                                    <div class="card-stats">
                                        <div class="main-stat">
                                            <div id="todayPointsEarned" class="stat-number">0</div>
                                            <div class="stat-unit">points earned</div>
                                        </div>
                                        <div class="sub-stats">
                                            <div class="sub-stat">
                                                <div id="todaySessionTime" class="sub-value">0h 0m</div>
                                                <div class="sub-label">study time</div>
                                            </div>
                                            <div class="sub-stat">
                                                <div id="todaySessionsCount" class="sub-value">0</div>
                                                <div class="sub-label">sessions</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Weekly Summary -->
                                <div class="overview-card">
                                    <div class="card-header">
                                        <h3>Weekly Summary</h3>
                                        <div class="date-label">This Week</div>
                                    </div>
                                    <div class="card-stats">
                                        <div class="main-stat">
                                            <div id="weeklyPointsTotal" class="stat-number">0</div>
                                            <div class="stat-unit">total points</div>
                                        </div>
                                        <div class="sub-stats">
                                            <div class="sub-stat">
                                                <div id="weeklyStudyTime" class="sub-value">0h</div>
                                                <div class="sub-label">study hours</div>
                                            </div>
                                            <div class="sub-stat">
                                                <div id="weeklyAvgDaily" class="sub-value">0</div>
                                                <div class="sub-label">avg/day</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="trend-indicator" id="trendIndicator">
                                        <span class="trend-arrow">📈</span>
                                        <span class="trend-text">Stable</span>
                                        <span id="performanceTrend">+0%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Charts -->
                        <div class="analytics-charts">
                            <div class="chart-section">
                                <h3>📊 Daily Points Trend</h3>
                                <div id="dailyPointsChart" class="chart-container">
                                    <!-- Chart will be rendered here -->
                                </div>
                            </div>

                            <div class="chart-section">
                                <h3>⏱️ Study Time Analysis</h3>
                                <div id="studyTimeChart" class="chart-container">
                                    <!-- Chart will be rendered here -->
                                </div>
                            </div>
                        </div>

                        <!-- Performance Table -->
                        <div class="performance-table-section">
                            <h3>📋 Detailed Daily Breakdown</h3>
                            <div class="table-container">
                                <table class="performance-table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Sessions</th>
                                            <th>Study Time</th>
                                            <th>Points</th>
                                            <th>Efficiency</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="performanceTableBody">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live Sessions Monitor Section -->
                <div id="mentorSessionsSection" class="content-section">
                    <div class="section">
                        <h2>🔴 Live Session Monitoring</h2>
                        <div id="liveSessionsMonitor" class="live-sessions-monitor">
                            <!-- Live session data will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Routine Management Section -->
                <div id="mentorRoutinesSection" class="content-section">
                    <div class="section">
                        <h2>📅 Session Management</h2>
                        <div id="routineManager" class="routine-manager">
                            <!-- Routine management will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Test Reports Section -->
                <div id="mentorTestsSection" class="content-section">
                    <div class="section">
                        <h2>📝 Test Performance Reports</h2>
                        <div id="testReports" class="reports-grid">
                            <!-- Test reports will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Punishments Section -->
                <div id="mentorPunishmentsSection" class="content-section">
                    <div class="section">
                        <h2>⚖️ Student Punishments</h2>
                        <div id="punishmentsList">
                            <!-- Punishments will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Routine Modal -->
    <div id="addRoutineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>➕ Add New Learning Session</h3>
                <button onclick="closeModal('addRoutineModal')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Session Name</label>
                    <input type="text" id="routineName" placeholder="e.g., Morning Exercise" class="form-input">
                </div>
                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" id="routineStartTime" class="form-input">
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="routineDuration" placeholder="30" min="1" class="form-input">
                </div>
                <div class="form-group">
                    <label>Points</label>
                    <input type="number" id="routinePoints" placeholder="10" min="1" class="form-input">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="routineCategory" class="form-input">
                        <option value="Health">Health</option>
                        <option value="Education">Education</option>
                        <option value="Personal">Personal</option>
                        <option value="Skills">Skills</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="saveRoutine()" class="btn btn-primary">💾 Add Session</button>
                <button onclick="closeModal('addRoutineModal')" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Edit Routine Modal -->
    <div id="editRoutineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>✏️ Edit Learning Session</h3>
                <button onclick="closeModal('editRoutineModal')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Session Name</label>
                    <input type="text" id="editRoutineName" class="form-input">
                </div>
                <div class="form-group">
                    <label>Start Time</label>
                    <input type="time" id="editRoutineStartTime" class="form-input">
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="editRoutineDuration" min="1" class="form-input">
                </div>
                <div class="form-group">
                    <label>Points</label>
                    <input type="number" id="editRoutinePoints" min="1" class="form-input">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="editRoutineCategory" class="form-input">
                        <option value="Health">Health</option>
                        <option value="Education">Education</option>
                        <option value="Personal">Personal</option>
                        <option value="Skills">Skills</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="updateRoutine()" class="btn btn-primary">💾 Update Session</button>
                <button onclick="closeModal('editRoutineModal')" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Test Taking Modal -->
    <div id="testTakingModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="testTakingTitle">Test Title</h3>
                <div class="test-info">
                    <div id="testTimeRemaining" class="test-timer">30:00</div>
                    <button onclick="closeTestModal()" class="close-btn">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="test-progress">
                    <div class="progress-bar">
                        <div id="testProgress" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">Question 1 of 10 (0 answered)</div>
                </div>

                <div id="testQuestionsContainer">
                    <!-- Questions will be rendered here -->
                </div>

                <div class="test-navigation">
                    <button id="prevQuestionBtn" onclick="previousQuestion()" class="btn btn-secondary">⬅️ Previous</button>
                    <div id="questionCounter">Question 1 of 10</div>
                    <button id="nextQuestionBtn" onclick="nextQuestion()" class="btn btn-secondary">Next ➡️</button>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="submitTest()" class="btn btn-primary">✅ Submit Test</button>
                <button onclick="closeTestModal()" class="btn btn-danger">❌ Exit Test</button>
            </div>
        </div>
    </div>

    <!-- Test Result Modal -->
    <div id="testResultModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📊 Test Results</h3>
                <button onclick="closeModal('testResultModal')" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="result-summary">
                    <div id="resultScore" class="result-score">0%</div>
                    <div id="resultDetails" class="result-details">0/0 Questions Correct</div>
                    <div id="resultMessage" class="result-message">Great job!</div>
                </div>
                <div id="resultBreakdown">
                    <!-- Breakdown will be shown here -->
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeModal('testResultModal')" class="btn btn-primary">Continue</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>